---
- name: Create service directories
  ansible.builtin.file:
    path: "{{ cmdbuild.work_dir }}"
    state: directory

- name: Copy docker compose file
  ansible.builtin.copy:
    src: files/compose.yaml
    dest: "{{ cmdbuild.work_dir }}/compose.yaml"

- name: Start docker compose file
  ansible.builtin.command: docker compose up -d
  environment:
    CMDBUILD_PORT: "{{ cmdbuild.port }}"
    POSTGRES_PORT: "{{ postgres.port }}"
    POSTGRES_PASSWORD: "{{ postgres.password }}"
  args:
    chdir: "{{ cmdbuild.work_dir }}"
